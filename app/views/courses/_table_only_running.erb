<table class="table table-sm table-striped">
  <thead>
    <tr>
      <th scope="col">Name</th>
      <th scope="col">Ends</th>
      <% if !@current_user.is_student%>
        <th scope="col">Enrollment key</th>
        <th scope="col">Status</th>
      <% end %>
      <th scope="col"></th>
    </tr>
  </thead>

  <tbody>
    <% course.lectures.each do |lecture| %>
      <% if lecture.status == "running" %>
        <tr>
          <td><%= lecture.name %></td>
          <td><%= lecture.end_time.strftime("%H:%M") %></td>
          <% if !@current_user.is_student%>
            <td><%= lecture.enrollment_key %></td>
            <td><%= lecture.status%></td>
          <% end %>
          <td class="text-right">
            <% if @current_user.is_student%>
              <%if lecture.participating_students.include?(@current_user)%>
                <%= link_to 'View', course_lecture_path(:course_id => @course.id, :id => lecture.id), {class:"btn btn-primary"} %>
              <% elsif lecture.enrollment_key_present?%>
                <%= form_tag(join_lecture_path(:course_id => @course.id, :id => lecture.id), autocomplete: "off") do -%>
                  <div>
                    <%= text_field :enrollment_key , class: "col-10"%>
                    <%= submit_tag 'Join', class: "btn btn-primary" %>
                  </div>
                <% end -%>
              <% end %>
            <% else %>
              <% if lecture.status == "running" %>
                <%= link_to 'End', end_lecture_path(:course_id => course.id, :id => lecture.id), method: :post, class:"btn btn-outline-secondary" %>
                <%= link_to 'Edit', edit_course_lecture_path(:course_id => course.id, :id => lecture.id), {class:"btn btn-outline-secondary"} %>
                <%= link_to 'View', course_lecture_path(:course_id => course.id, :id => lecture.id), {class:"btn btn-primary"} %>
              <% end %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>