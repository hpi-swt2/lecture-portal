<%= render 'tabbar', current_user: @current_user %>

<h5><%= @lecture.name %></h5>
<% if @lecture.start_time &&  @lecture.end_time && @lecture.date%>
  <p><%= @lecture.date.strftime("%d.%m.%Y") %> <%= @lecture.start_time.strftime("%H:%M -") %> <%= @lecture.end_time.strftime("%H:%M") %></p>
<% end %>
<div class="tab-content" id="lectureTabsContent" style="width: 70vw">
  <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab" style="width: 70vw">
    <div id="updates" style="width: 70vw">
      <table>
        <tr>
          <td style="width: 30vw">
            <% if @current_user.is_student %>
              <h5>Updates</h5>
            <% else %>
              <h5>Questions</h5>
            <% end %>
          </td>
          <td style="width: 30vw">
            <h5>Materials</h5>

          </td>
        </tr>
        <tr>
          <td>
            <%= react_component("UpdatesApp", {user_id: @current_user.id, is_student: @current_user.is_student, lecture_id: @lecture.id, course_id: @lecture.course.id}) %>
          </td>
          <td>
            <%= render 'components/show_uploaded_files_or_links', uploaded_files: @uploaded_files %>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div class="tab-pane fade" id="questions" role="tabpanel" aria-labelledby="questions-tab">
    <% if @lecture.questions_enabled %>
      <%= react_component("QuestionsApp",  {user_id: @current_user.id, is_student: @current_user.is_student, lecture_id: @lecture.id, course_id: @lecture.course.id, interactions_enabled: !@lecture.readonly?} ) %>
    <% else %>
      <h1> Questions are not enabled. :(</h1>
    <% end %>
  </div>

  <div class="tab-pane fade poll-tab-container" id="polls" role="tabpanel" aria-labelledby="polls-tab" >
    <% if @lecture.polls_enabled%>
      <iframe class="polls-iframe" src="<%= course_lecture_polls_path(@course, @lecture) %>"></iframe>
    <% else %>
      <h1> Polls are not enabled. :( </h1>
    <% end %>
  </div>

  <div class="tab-pane fade" id="feedback" role="tabpanel" aria-labelledby="feedback-tab">

    <% if @current_user.is_student %>

      <%= form_with(model: [ @course, @lecture, @lecture.feedbacks.build ]) do |form| %>
        <p>
          <%= form.label :content %><br>
          <%= form.text_field :content %>
        </p>
        <p>
          <%= form.submit %>
        </p>
      <% end %>

    <% else %>

      <% @lecture.feedbacks.each do |feedback| %>
        <p>
          <strong>Feedback:</strong>
          <%= feedback.content %>
        </p>
      <% end %>

    <% end %>

  </div>
  <% if !@current_user.is_student %>
    <div class="tab-pane fade" id="enrollmentKey" role="tabpanel" aria-labelledby="enrollmentKey-tab-tab">
      <h1 class="padded-text">Enrollment Key: <%= @lecture.enrollment_key %></h1>
    </div>
    <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
      <%= render 'form', lecture: @lecture %>
    </div>
  <% end %>
</div>

<table>
  <tr>
    <td colspan="2"><%= link_to 'Back', course_path(@course), class:"btn btn-link" %> </td>
    <% if !@current_user.is_student %>
      <% if @lecture.created? %>
          <td colspan="2"> | <%= link_to "Edit", edit_course_lecture_path(course_id: @lecture.course.id, id: @lecture.id), class:"btn btn-link" %></td>
        <td colspan="2"> | <%= link_to "Start", start_lecture_path(course_id: @lecture.course.id, id: @lecture.id), method: :post, class:"btn btn-link" %></td>
      <% elsif @lecture.running? %>
        <td colspan="2"> | <%= link_to 'New Poll', new_course_lecture_poll_path(@course, @lecture), {class:"btn btn-link"} %> </td>
      <%end %>
  <%end %>
  </tr>
</table>